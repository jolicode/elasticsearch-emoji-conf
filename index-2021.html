<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <title>Indexer des Emoji 🍕 dans Elasticsearch pour trouver des pizzas</title>

    <meta name="description" content="Indexer des Emoji 🍕 dans Elasticsearch pour trouver des pizzas">
    <meta name="author" content="JoliCode">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="shortcut icon" href="favicon.ico">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/jolicode.css" id="theme">

    <style>
        .reveal em {
            display: inline-block;
            background-color: #f7d325;
            padding: 8px 12px;
            font-style: normal;
            color:black;
            border: 2px solid gray;
            border-radius: 10px;
        }
    </style>

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
</head>

<body>

<div class="reveal">

    <!-- Any section element inside of this container is displayed as a slide -->
    <div class="slides">
        <section>
            <h2>Indexer des Emoji <br>« 🍕 »<br> dans Elasticsearch pour trouver des pizzas !</h2>

        </section>

        <section data-state="jolistate">
            <h2 class="no-caps">@damienalexandre</h2>

            <p>
                <a href="https://twitter.com/damienalexandre">
                    <img src="images/supergeek.png" alt="Me"
                         style="width: 30%; vertical-align: middle; background-color: white!important; padding:10px;border-radius: 15px">
                </a>
            </p>

            <p>PHP, Elasticsearch, Symfony, Emoji</p>
        </section>

        <section>
            <h2 class="no-caps">Pourquoi des emoji ?</h2>

            <ul>
                <li>Un texte seul porte difficilement un ton, une intonation, qu'un échange verbal permet</li>
                <li>Avec l'explosion des conversations SMS et numériques, nous avons adopté des Emoticons :</li>
            </ul>
            <blockquote>:-)&nbsp;&nbsp;&nbsp;&nbsp;:D&nbsp;&nbsp;&nbsp;&nbsp;:-(&nbsp;&nbsp;&nbsp;&nbsp;
                ^_^&nbsp;&nbsp;&nbsp;&nbsp;;-)&nbsp;&nbsp;&nbsp;&nbsp;<3
            </blockquote>
        </section>

        <section>
            <h2 class="no-caps">Le message qui a tout changé</h2>

            <pre><code class="hljs nohighlight" data-trim>
19-Sep-1982 11:44 Scott E Fahlman
From: Scott E Fahlman

I propose that the following character sequence
for joke markers:

:-)

Read it sideways. Actually, it is probably more
economical to mark things that are NOT jokes,
given current trends. For this, use

:-(
            </code></pre>
        </section>

        <section>
            <h2 class="no-caps">Grosse créativité</h2>

            <pre><code class="hljs nohighlight" data-trim>
(^_^) [o_o] (^.^)  (".") ($.$) {-_-}

(╯°□°）╯︵ ┻━┻

¯\_(ツ)_/¯

( ͡° ͜ʖ ͡°)
            </code></pre>
        </section>

        <section>
            <h2 class="no-caps">Nos téléphones évoluent</h2>

            <img src="images/evolution-phone.jpg" alt="Phone evolution">
        </section>

        <section>
            <p>En 1998, un opérateur Japonais introduit des icônes colorés dans les messages pour
                se démarquer de la concurrence.</p>
                <p>176 pictogrammes de 12x12 pixels</p>

            <img src="images/NTT_DoCoMo_logo.png"
                 style="width: 50%;background-color: white !important;display: block; padding: 20px;
                    margin:auto;" alt="NTT DoCoMo">
        </section>

        <section data-background="images/original-emoji.jpg">
        </section>

        <section>
            <ul>
                <li>Tous les opérateurs s'y sont mis</li>
                <li>Chacun avec son propre jeu propriétaire...</li>
                <li>La transmission était sur 2 octets (en utilisant un range privé Unicode)</li>
                <li>Si vous étiez chez NTT DoCoMo, vous ne pouviez pas voir les emoji envoyés par votre ami chez SoftBank Mobile 😧</li>
                <li class="fragment">Avec le temps, les opérateurs ont ajouté un mapping...</li>
            </ul>
        </section>
        
        <section>
            <img src="images/unicode.PNG" alt="Unicode" style="background-color: white!important; padding: 20px; ;">
        </section>

        <section>
            <h2 class="no-caps">Unicode</h2>

            <ul>
                <li>Standard informatique du texte depuis 1991</li>
                <li>Coordonné par le Consortium Unicode (organisation privée sans but lucratif)</li>
                <li>Commence à s'intéresser aux Emoji en 2007</li>
            </ul>
        </section>

        <section>
            <h2 class="no-caps">La naissance des Emoji</h2>

            <ul>
                <li>855 emoji intégrés à Unicode 6.0 en 2010
                    <ul>
                        <li>Les pictogrammes Japonais</li>
                        <li>Quelques nouveaux</li>
                        <li>Certains icônes déjà dans Unicode</li>
                    </ul>
                </li>
            </ul>

            <p>🍢 🍤 🍥 🏯 👘 🎌 🗻 🎏</p>
            <p>😑 😬 💩 🦄 🐙 🚙 🌦 🎸</p>
        </section>


        <section>
            <h2 class="no-caps">Adoption</h2>

            <ul>
                <li>Ajouté dans l'iPhone en 2008, au Japon uniquement 🇯🇵
                <li>Support complet en 2011
                <li>Tout le monde a suivi, d'Android à Windows</li>
            </ul>
        </section>


        <section>
            <h2 class="no-caps">□ Support aujourd'hui □</h2>

            <ul>
                <li>Apple iOS et macOS</li>
                <li>Android</li>
                <li>Windows 10</li>
                <li>Linux 🐧 Ubuntu 18.04</li>
                <li><a href="http://caniemoji.com/">caniemoji.com</a></li>
                <li>Problèmes : sans couleurs ⛇, tofu □, invalide �...</li>
                <li class="fragment">Elasticsearch ?</li>
            </ul>
        </section>


        <section>
            <h2 class="no-caps">Les code points</h2>

            <ul>
                <li><em>U+1F355</em> est 🍕
                <li><em>U+1F308</em> est 🌈
                <li><em>U+1F427</em> est 🐧
            </ul>
        </section>

        <section>
            <h2 class="no-caps">Les Emoji dans Unicode</h2>

            <p>Les emoji sont comme du texte. C'est votre système d'exploitation qui est capable de les afficher en image.</p>

            <p>
                <img src="images/display-devices.png" alt="emoji display accross devices">
            </p>

            <p><small><a href="https://unicode.org/emoji/charts/full-emoji-list.html">Full emoji list.</a></small></p>
        </section>

        <section>
            <img src="images/fail-samsung-cookies.png" alt="Emoji fail cookies">
        </section>

        <section>
            <img src="images/fail-google-burger.png" alt="Emoji fail burger order" style="width: 60%">
        </section>

        <section>
            <img src="images/fail-samsung-hand.jpeg" alt="Emoji fail hands">
        </section>

        <section>
            <h3>Peu importe ce qui est affiché, c'est le code point qui porte le sens.</h3>
        </section>

       <!-- <section>
            <h2 class="no-caps">Les emoji et le texte</h2>

            <p>La spécification comporte maintenant :</p>

            <ul>
                <li>Des métiers 👮 ;</li>
                <li>Des émotions 😍 ;
                <li>De la nourriture 🍕 ;
                <li>Des animaux 🐘 ;
                <li>Des sports 🚴 ;
                <li>Des objets 💐 📋 🔦…
            </ul>

        </section>-->

        <section>
            <h2 class="no-caps">L'utilisation des emoji</h2>

            <h5>Vous n'y échapperez pas !</h5>
            <ul>
                <li>Word of the Year du Oxford English Dictionary 2015 : 😂
                <li>World Emoji Day le 17 Juillet 🎉
                <li>Supporté partout ! Saisie super simple et claviers dédiés sur mobile ⌨</li>
                <li>Emojipedia.org fait 45 millions de pages vues par mois</li>
            </ul>
        </section>

        <section>
            <h2>Oui, vos utilisateurs vont saisir 🍕 dans votre moteur de recherche !</h2>
        </section>

        <section>
            <img src="images/github2.png" alt="Github">
        </section>
        <section>
            <img src="images/twitter2.png" alt="Twitter">
        </section>
        <section>
            <img src="images/yelp2.png" alt="Yelp">
        </section>

        <section>
            <h2 class="no-caps">Comment chercher comme Yelp</h2>
        </section>

        <section>
            <pre><code class="hljs json" data-trim>
PUT meal/_doc/1
{
  "title": "pizza"
}

GET meal/_search
{
  "query": {
    "match": {
      "title": "🍕"
    }
  }
}</code></pre>

            <p class="fragment">Aucun résultat</p>
        </section>

        <section>
            <h2 class="no-caps">C'est standard</h2>

            <ul>
                <li>Unicode spécifie <a href="http://unicode.org/reports/tr51/#Searching">comment faire de la recherche</a> (TR51)
                <li>Chaque emoji doit être indexé avec ses annotations, et cela dans toutes les langues cibles
            </ul>
        </section>

        <section>
            <h2 class="no-caps">Annotations CLDR de 🍕</h2>

            <ul>
                <li>En Anglais : cheese, pizza, slice</li>
                <li>En Français : fromage, part, pizza</li>
            </ul>

            <br>
            <br>
            <br>
            <h4 class="no-caps">Nous devons indexer "pizza" <br>quand il y a un emoji 🍕</h4>
            <h4 class="no-caps fragment">C'est le boulot des synonymes !</h4>
        </section>

        <section>
            <img style="width: 100%" src="images/ElasticsearchHorizontalTextWhite.svg" alt="Elasticsearch">
        </section>

        <section>
            <h2 class="no-caps">Dans Elasticsearch</h2>

            <ul>
                <li>Depuis 6.7 : Lucene 7.7.0 comprends les Emoji 🥰</li>
                <li>Entre 6.4 et 6.7 : Plugin officiel analysis-icu</li>
                <li>Avant 6.4 : 😵 <a href="https://github.com/jolicode/emoji-search/tree/master/esplugin">Plugin maison</a> 🔥
                et plein de hack </li>
            </ul>
        </section>

        <section>
            <h2 class="no-caps">Lucene 7.7 ❤️</h2>

            <p>Extrait des tests de Lucene :</p>
            <pre><code class="hljs java" data-trim>
/** simple emoji */
public void testEmoji() throws Exception {
    BaseTokenStreamTestCase.assertAnalyzesTo(
        a,
        "💩 💩💩",
        new String[] {"💩", "💩", "💩"},
        new String[] {"&lt;EMOJI&gt;", "&lt;EMOJI&gt;", "&lt;EMOJI&gt;"}
    );
}</code></pre>

            <small>
                <a href="https://github.com/apache/lucene-solr/commit/283b19a8da6ab9e0b7e9a75b132d3067218d5502#diff-f8560c7a9c79fa371685c42a5bb486ebd0dbb56479e9af5849911dd95f4432db">
                    Le commit qui a tout changé : "support Unicode UTS#51 v11.0 Emoji tokenization."
                </a>
            </small>
        </section>

        <section>
            <h2 class="no-caps">Emoji simple</h2>

            <pre><code class="hljs json" data-trim>
GET _analyze
{
  "text": ["🍕"],
  "analyzer": "standard"
}</code></pre>

            <p class="fragment">Token <em>🍕</em></p>
        </section>

        <section>
            <h2 class="no-caps">Ajout des synonymes</h2>

            <pre><code class="hljs json" data-trim>
GET _analyze
{
  "text": ["🍕"],
  "tokenizer": "standard",
  "filter": [
    {
      "type": "synonym",
      "synonyms": [
        "🍕 => 🍕, cheese, pizza, slice"
      ]
    }
  ]
}</code></pre>

            <p class="fragment">Tokens <em>🍕</em> <em>cheese</em> <em>pizza</em> <em>slice</em></p>
        </section>

        <section>
            <h2 class="no-caps">Recherche fonctionnelle</h2>

            <p class="">Tokens <em>🍕</em> <em>cheese</em> <em>pizza</em> <em>slice</em> dans l'index</p>

            <ul>
                <li>Recherche avec "🍕" : match ✅</li>
                <li>Recherche avec "pizza" : match ✅</li>
            </ul>
        </section>

        <section>
            <h2 class="no-caps">Liste de synonymes</h2>

            <ul>
                <li>Le CLDR fourni les annotations dans toutes les langues</li>
                <li>Unicode Common Locale Data Repository</li>
                <li>Je fournis juste les fichiers de synonymes déjà prêts :</li>
            </ul>

            <p><a href="https://github.com/jolicode/emoji-search/">https://github.com/jolicode/emoji-search/</a></p>
        </section>

        <section>
            <pre>
    🐻 => 🐻, bear, bear face, face
    🐨 => 🐨, bear, koala
    🐼 => 🐼, face, panda, panda face
    🐾 => 🐾, feet, paw, paw prints, print
    🦃 => 🦃, bird, turkey
    🥵 => 🥵, feverish, heat stroke, hot, hot face, red-faced, sweating
    🥶 => 🥶, blue-faced, cold, cold face, freezing, frostbite, icicles
    🐣 => 🐣, baby, bird, chick, hatching, hatching chick
    🐤 => 🐤, baby, baby chick, bird, chick
    🐥 => 🐥, baby, bird, chick, front-facing baby chick
    🤞 => 🤞, cross, crossed fingers, finger, hand, luck
    🤟 => 🤟, hand, ILY, love-you gesture
    🌾 => 🌾, ear, grain, rice, sheaf of rice
    👱‍♀ => 👱‍♀, blond-haired woman, blonde, hair, woman, woman: blond hair
    🧓 => 🧓, adult, gender-neutral, old, older person, unspecified gender
    👴 => 👴, adult, man, old
    🧝‍♀ => 🧝‍♀, magical, woman elf
    🧞 => 🧞, djinn, genie
    ...
            </pre>
        </section>


        <section>
            <h2>C'est un peu plus complexe dans la vraie vie</h2>
        </section>

        <section data-background="images/fun_flags.jpeg">
        </section>

        <section>
            <h2 class="no-caps">Composition</h2>

            <img src="images/raibowflag.png" alt="rainbow flag" style="position: absolute; right: 0; margin-top: 100px">
            <ul>
                <li>
                    Séquence <abbr title="Zero Width Joiner">ZWJ</abbr> pour afficher un drapeau arc en ciel :

                    <ol>
                        <li>🏳 <em>U+1F3F3</em></li>
                        <li>ZWJ <em>U+200D</em></li>
                        <li>🌈 <em>U+1F308</em></li>
                    </ol>
                </li>
            </ul>
        </section>

        <section>
            <h2 class="no-caps">ZWJ dans ES</h2>

            <pre><code class="hljs json" data-trim>
GET _analyze
{
  "text": ["🏳‍🌈"],
  "tokenizer": "standard",
  "filter": [
    {
      "type": "synonym",
      "synonyms": [
        "🏳‍🌈 => 🏳‍🌈, pride, rainbow, rainbow flag"
      ]
    }
  ]
}</code></pre>

            <p class="fragment">Tokens <em>🏳‍🌈</em> <em>pride</em> <em>rainbow</em> <em>flag</em><br>
            La jointure est bien connue d'Elasticsearch</p>
        </section>

        <section>
            <h2 class="no-caps">Drapeaux</h2>

            <ul>
                <li>
                    249 combinaisons basées sur ISO 3166-1 alpha-2
                    <ul>
                        <li>Regional indicator symbol :
                        <li>🇦 🇧 🇨 🇩 🇪 🇫 🇬 🇭 🇮 🇯 🇰 🇱 🇲 🇳 🇴 🇵 🇶 🇷 🇸 🇹 🇺 🇻 🇼 🇽 🇾 🇿
                        <li>🇨 <em>U+1F1E8</em> et 🇦 <em>U+1F1E6</em> = 🇨🇦
                        <li>🇨🇭 🇨🇳 🇩🇪 🇪🇸 🇫🇷 🇬🇧 🇮🇹 🇯🇵 🇰🇷 🇷🇺 🇺🇸...
                    </ul>
                </li>
            </ul>
        </section>


        <section>
            <h2 class="no-caps">Drapeaux</h2>

            <ul>
                <li>
                    D'autres exemples :
                    <ul>
                        <li>🇮🇨 IC Canary Islands
                        <li>🇽🇰 XK Kosovo
                        <li>🇺🇳 UN United Nations
                        <li>🇪🇺 EU European Union
                        <li>🇹🇼 TW Taiwan, caché en Chine</li>
                    </ul>
                </li>
            </ul>
        </section>

        <section>
            <h2 class="no-caps">Drapeaux dans ES</h2>

            <pre><code class="hljs json" data-trim>
GET _analyze
{
  "text": ["🇪🇺"],
  "tokenizer": "standard",
  "filter": [
    {
      "type": "synonym",
      "synonyms": [
        "🇪🇺 => 🇪🇺, flag: European Union"
      ]
    }
  ]
}</code></pre>

            <p class="fragment">Tokens <em>🇪🇺</em> <em>flag</em> <em>European</em> <em>Union</em><br>
                Combinaisons lues par Elasticsearch</p>
        </section>

        <section>
            <h2 class="no-caps">Drapeaux subdivisions</h2>

            <ul>
                <li>
                    ISO 3166-2 subdivisions administratives
                    <ul>
                        <li>🏴󠁧󠁢󠁳󠁣󠁴󠁿 GB-SCT Écosse
                        <li>🏴󠁧󠁢󠁷󠁬󠁳󠁿 GB-WLS Wales
                        <li>+ de 3000 possibilitées
                        <li>Seulement 4 supportées actuellement
                        <li class="fragment">On l'aura notre emoji <a href="https://www.emoji.bzh/">BZH</a> !
                    </ul>
                </li>
            </ul>
        </section>

        <section>
            <h2 class="no-caps">🏴󠁧󠁢󠁳󠁣󠁴󠁿 GB-SCT explosé</h2>
            <ul style="font-size: 80%">
                <li><em>U+1F3F4</em> 🏴
                <li><em>U+E0067</em> TAG g
                <li><em>U+E0062</em> TAG b
                <li><em>U+E0073</em> TAG s
                <li><em>U+E0063</em> TAG c
                <li><em>U+E0074</em> TAG t
                <li><em>U+E007F</em> CANCEL TAG
            </ul>
        </section>

        <section>
            <h2 class="no-caps">Subdivisions dans ES</h2>

            <pre><code class="hljs json" data-trim>
GET _analyze
{
  "text": ["🏴󠁧󠁢󠁳󠁣󠁴󠁿"],
  "tokenizer": "standard",
  "filter": [
    {
      "type": "synonym",
      "synonyms": [
        "🏴󠁧󠁢󠁳󠁣󠁴󠁿 => 🏴󠁧󠁢󠁳󠁣󠁴󠁿, flag, Scotland",
        "🏴󠁦󠁲󠁢󠁲󠁥󠁿 => 🏴󠁦󠁲󠁢󠁲󠁥󠁿, flag, Bretagne, BZH"
      ]
    }
  ]
}</code></pre>

            <p class="fragment">Tokens <em>🏴󠁧󠁢󠁳󠁣󠁴󠁿</em> <em>flag</em> <em>Scotland</em><br>
                Très bon support</p>
        </section>

        <section>
            <h2 class="no-caps">Les modificateurs</h2>

            <ul>
                <li>
                    Fitzpatrick
                    <ul>
                        <li>🤘 <em>U+1F918</em>
                        <li>🤘🏽 <em>U+1F918</em> + <em>U+1F3FD</em>
                    </ul>
                </li>
            </ul>
        </section>

        <section>
            <h2 class="no-caps">Fitzpatrick dans ES</h2>

            <pre><code class="hljs json" data-trim>
GET _analyze
{
  "text": ["🤘🏽"],
  "tokenizer": "standard",
  "filter": [
    {
      "type": "synonym",
      "synonyms": [
        "🤘🏽 => 🤘🏽, horns, medium skin tone"
      ]
    }
  ]
}</code></pre>

            <p class="fragment">Tokens <em>🤘🏽</em> <em>horns</em> <em>medium</em> <em>skin</em> <em>tone</em><br>
                Supporté aussi mais synonyme à affiner</p>
        </section>

        <section>
            <h2 class="no-caps">Sélecteur de variation</h2>

            <ul>
                <li>
                    Variations, exemple avec HEAVY BLACK HEART

                    <ul>
                        <li><em>❤ </em> U+2764 en texte</li>
                        <li><em>❤️</em> U+2764 + U+FE0F en Emoji</li>
                        <li><em>🏳 U+FE0F ZWJ 🌈</em> !== <em>🏳 ZWJ 🌈</em></li>
                    </ul>
                </li>


            </ul>
        </section>

        <section>
            <h2 class="no-caps">Variations ES</h2>

            <pre><code class="hljs json" data-trim>
GET _analyze
{
  "text": ["🏳️‍🌈" , "❤️"],
  "tokenizer": "standard",
  "filter": [
    {
      "type": "synonym",
      "synonyms": [
        "🏳‍🌈 => 🏳‍🌈, pride, rainbow, rainbow flag",
        "❤ => ❤, heart, red heart"
      ]
    }
  ]
}</code></pre>

            <p class="fragment">Tokens <em>🏳️‍🌈</em> <em>❤️</em><br>
                Nos synonymes ne matchent pas !</p>
        </section>

        <section>
            <h2 class="no-caps">Variations ES</h2>

            <p>
                On supprime les variateurs AVANT le filter de synonyme
            </p>

            <pre><code class="hljs json" data-trim>
{
  "type": "pattern_replace",
  "pattern": "\\uFE0E|\\uFE0F",
  "replace": ""
}
</code></pre>

            <p class="">Tokens <em>🏳️‍🌈</em> <em>❤️</em> <em>pride</em> <em>rainbow</em> <em>heart</em>...</p>
        </section>

        <section>
            <h2 class="no-caps">Les nouveaux emoji</h2>

            <ul>
                <li>Nouvelle version majeure d'Unicode tous les ans</li>
                <li>Elasticsearch 7.10.2 = Lucene 8.7.0 = Unicode 11</li>
                <li>Unicode 13 actuellement (Mars 2020)</li>
            </ul>
        </section>

        <section>
            <h2 class="no-caps">Nouveaux emoji dans ES</h2>

            <pre><code class="hljs json" data-trim>
GET _analyze
{
  "text": ["🤌🏽", "🥷🏿"]
}
</code></pre>

            <p class="">Tokens <em>🤌</em> <em>🏽</em> <em>🥷</em> <em>🏿</em> séparés !</p>

            <p>
                <img style="height: 150px" src="images/pinched.png" alt="Pinched">
                <img style="height: 150px" src="images/ninja.png" alt="Ninja">
            </p>

            <p><small>Mais globalement c'est très fonctionnel.</small></p>
        </section>

        <section>
            <h2 class="no-caps">Récapitulons</h2>

            <ul>
                <li>Installer un fichier de synonymes</li>
                <li>Supprimer les sélecteurs de variation</li>
                <li>Utiliser un token filter synonym</li>
            </ul>
        </section>

        <section>
            <code style="text-align: left;">
$ wget https://github.com/jolicode/emoji-search/raw/master/synonyms/cldr-emoji-annotation-synonyms-en.txt<br><br>
$ mv cldr-emoji-annotation-synonyms-en.txt /etc/elasticsearch/analysis/
            </code>
        </section>

        <section>
            <pre><code class="hljs json" data-trim style="font-size: 90%">PUT /tweets
{
  "settings": {
    "analysis": {
      "filter": {
        "english_emoji": {
          "type": "synonym",
          "synonyms_path": "analysis/cldr-emoji-annotation-synonyms-en.txt"
        },
        "emoji_variation_selector_filter": {
          "type": "pattern_replace",
          "pattern": "\\uFE0E|\\uFE0F",
          "replace": ""
        }
      },
      "analyzer": {
        "english_with_emoji": {
          "tokenizer": "standard",
          "filter": [
            "lowercase",
            "emoji_variation_selector_filter",
            "english_emoji"
          ]
        }
      }
    }
  }
}
            </code></pre>
        </section>

        <section>
            <pre><code class="hljs json" data-trim>GET tweets/_analyze
{
  "analyzer": "english_with_emoji",
  "text": "🍕 🍍"
}</code></pre>

            <p>
                <em>🍕</em>
                <em>cheese</em>
                <em>pizza</em>
                <em>slice</em>
                <em>🍍</em>
                <em>fruit</em>
                <em>pineapple</em>
            </p>

            <p class="fragment">
                <img src="images/pineapple%20pizza.jpg" alt="Pizza">
            </p>
        </section>

        <section>
            <h2 class="no-caps">Aller plus loin...</h2>
        </section>

        <section>
            <h2 class="no-caps">Gérer les emoticons</h2>

            <blockquote>:-)&nbsp;&nbsp;&nbsp;&nbsp;:D&nbsp;&nbsp;&nbsp;&nbsp;:-(&nbsp;&nbsp;&nbsp;&nbsp;
                ^_^&nbsp;&nbsp;&nbsp;&nbsp;;-)&nbsp;&nbsp;&nbsp;&nbsp;<3
            </blockquote>

            <p class="fragment">On va simplement mapper les emoticons vers leurs emoji respectifs avant la tokenisation !</p>
        </section>



        <section>
            <h2 class="no-caps">Emoticon Mapping</h2>

            <h3><em>:p</em> ressemble à 😛</h3>

            <pre><code class="hljs text" data-trim>
:P => 😛
8-) => 😎
:s => 😒
:| => 😐
O:-D => 😇
&lt;/3 => 💔
:'-| => 😢
</code></pre>
        </section>

        <section>
            <h2 class="no-caps">Un nouveau char_filter</h2>

            <pre><code class="hljs java" data-trim>"char_filter": {
    "emoticons_char_filter": {
      "type": "mapping",
      "mappings_path": "analysis/emoticons.txt"
    }
},</code></pre>

            <p>Fichier de mapping disponible : <a
                    href="https://github.com/jolicode/emoji-search/blob/master/emoticons.txt">https://github.com/jolicode/emoji-search/blob/master/emoticons.txt</a></p>
        </section>

        <section>
            <h2 class="no-caps">Un nouveau char_filter</h2>

            <pre><code class="hljs java" data-trim>"analyzer": {
   "english_with_emoji": {
     "char_filter": ["emoticons_char_filter"],
     "tokenizer": "standard",
     "filter": [
       "lowercase",
       "emoji_variation_selector_filter",
       "english_emoji"
     ]
   }
 }</code></pre>
        </section>

        <section>
            <pre><code class="hljs json" data-trim>GET tweets/_analyze
{
  "analyzer": "english_with_emoji",
  "text": "Sarcasm ;-)"
}</code></pre>

            <p>
                <em>sarcasm</em>
                <em>😉</em>
                <em>face</em>
                <em>wink</em>
                <em>winking face</em>
            </p>

            <p class="fragment">
                Des informations d'intention / émotion en plus<br>
                =<br>
                Une meilleure expérience de recherche
            </p>
        </section>

        <section>
            <h2>Pour résumer</h2>

            <ul>
                <li>Les emoji sont des lettres comme les autres 🔠</li>
                <li>Leur recherche se base sur des synonymes 👥</li>
                <li>Le CLDR produit ses annotations pour nous 📝</li>
                <li>Un fichier de synonymes tout prêt disponible ✅</li>
                <li>Il y a plein de combinaisons possibles ♾️</li>
                <li>Supportez les emoji partout (sauf les mots de passe) 🔒</li>
            </ul>
        </section>


        <section>
            <p>
                Merci pour votre attention 🤘
            </p>

            <p>
                @damienalexandre
                <br>
                <a href="https://github.com/jolicode/emoji-search/">https://github.com/jolicode/emoji-search/</a>
            </p>

            <p>
                <a href="http://jolicode.com">
                    <img src="./lib/font/logo-fond-noir.svg" alt="JoliCode"  style="height: 90px;"/>
                </a>
            </p>

            <h2 style="font-size: 40px;">Développement Web<br>expertise<br>open-source</h2>
        </section>

        <section data-markdown>
            <script type="text/template">
                ## Ressources

                - https://emojipedia.org/
                - https://issues.apache.org/jira/browse/LUCENE-8366
                - https://www.unicode.org/reports/tr51/tr51-18.html
                - https://meowni.ca/posts/emoji-emoji-emoji/
                - https://twitter.com/damienalexandre
            </script>
        </section>

    </div>
</div>

<footer class="joli">
    « Indexer des Emoji 🍕 dans Elasticsearch pour trouver des pizzas » &dash; ElasticCC 2021 &dash; <img
        src="lib/font/logo-fond-noir.svg" style="height:1em; vertical-align: text-bottom;"/>
</footer>


<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>

    // More info https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        transition: 'none', // none/fade/slide/convex/concave/zoom

        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
            {
                src: 'lib/js/classList.js', condition: function () {
                return !document.body.classList;
            }
            },
            {
                src: 'plugin/markdown/marked.js', condition: function () {
                return !!document.querySelector('[data-markdown]');
            }
            },
            {
                src: 'plugin/markdown/markdown.js', condition: function () {
                return !!document.querySelector('[data-markdown]');
            }
            },
            {
                src: 'plugin/highlight/highlight.js', async: true, callback: function () {
                hljs.initHighlightingOnLoad();
            }
            },
            {src: 'plugin/zoom-js/zoom.js', async: true},
            {src: 'plugin/notes/notes.js', async: true}
        ]
    });
</script>

</body>
</html>
