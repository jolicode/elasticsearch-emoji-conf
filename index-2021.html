<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <title>Indexer des Emoji ğŸ• dans Elasticsearch pour trouver des pizzas</title>

    <meta name="description" content="Indexer des Emoji ğŸ• dans Elasticsearch pour trouver des pizzas">
    <meta name="author" content="JoliCode">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="shortcut icon" href="favicon.ico">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/jolicode.css" id="theme">

    <style>
        .reveal em {
            display: inline-block;
            background-color: #f7d325;
            padding: 8px 12px;
            font-style: normal;
            color:black;
            border: 2px solid gray;
            border-radius: 10px;
        }
    </style>

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
</head>

<body>

<div class="reveal">

    <!-- Any section element inside of this container is displayed as a slide -->
    <div class="slides">
        <section>
            <h2>Indexer des Emoji <br>Â« ğŸ• Â»<br> dans Elasticsearch pour trouver des pizzas !</h2>

        </section>

        <section data-state="jolistate">
            <h2 class="no-caps">@damienalexandre</h2>

            <p>
                <a href="https://twitter.com/damienalexandre">
                    <img src="images/supergeek.png" alt="Me"
                         style="width: 30%; vertical-align: middle; background-color: white!important; padding:10px;border-radius: 15px">
                </a>
            </p>

            <p>PHP, Elasticsearch, Symfony, Emoji</p>
        </section>

        <section>
            <h2 class="no-caps">Pourquoi des emoji ?</h2>

            <ul>
                <li>Un texte seul porte difficilement un ton, une intonation, qu'un Ã©change verbal permet</li>
                <li>Avec l'explosion des conversations SMS et numÃ©riques, nous avons adoptÃ© des Emoticons :</li>
            </ul>
            <blockquote>:-)&nbsp;&nbsp;&nbsp;&nbsp;:D&nbsp;&nbsp;&nbsp;&nbsp;:-(&nbsp;&nbsp;&nbsp;&nbsp;
                ^_^&nbsp;&nbsp;&nbsp;&nbsp;;-)&nbsp;&nbsp;&nbsp;&nbsp;<3
            </blockquote>
        </section>

        <section>
            <h2 class="no-caps">Le message qui a tout changÃ©</h2>

            <pre><code class="hljs nohighlight" data-trim>
19-Sep-1982 11:44 Scott E Fahlman
From: Scott E Fahlman

I propose that the following character sequence
for joke markers:

:-)

Read it sideways. Actually, it is probably more
economical to mark things that are NOT jokes,
given current trends. For this, use

:-(
            </code></pre>
        </section>

        <section>
            <h2 class="no-caps">Grosse crÃ©ativitÃ©</h2>

            <pre><code class="hljs nohighlight" data-trim>
(^_^) [o_o] (^.^)  (".") ($.$) {-_-}

(â•¯Â°â–¡Â°ï¼‰â•¯ï¸µ â”»â”â”»

Â¯\_(ãƒ„)_/Â¯

( Í¡Â° ÍœÊ– Í¡Â°)
            </code></pre>
        </section>

        <section>
            <h2 class="no-caps">Nos tÃ©lÃ©phones Ã©voluent</h2>

            <img src="images/evolution-phone.jpg" alt="Phone evolution">
        </section>

        <section>
            <p>En 1998, un opÃ©rateur Japonais introduit des icÃ´nes colorÃ©s dans les messages pour
                se dÃ©marquer de la concurrence.</p>
                <p>176 pictogrammes de 12x12 pixels</p>

            <img src="images/NTT_DoCoMo_logo.png"
                 style="width: 50%;background-color: white !important;display: block; padding: 20px;
                    margin:auto;" alt="NTT DoCoMo">
        </section>

        <section data-background="images/original-emoji.jpg">
        </section>

        <section>
            <ul>
                <li>Tous les opÃ©rateurs s'y sont mis</li>
                <li>Chacun avec son propre jeu propriÃ©taire...</li>
                <li>La transmission Ã©tait sur 2 octets (en utilisant un range privÃ© Unicode)</li>
                <li>Si vous Ã©tiez chez NTT DoCoMo, vous ne pouviez pas voir les emoji envoyÃ©s par votre ami chez SoftBank Mobile ğŸ˜§</li>
                <li class="fragment">Avec le temps, les opÃ©rateurs ont ajoutÃ© un mapping...</li>
            </ul>
        </section>
        
        <section>
            <img src="images/unicode.PNG" alt="Unicode" style="background-color: white!important; padding: 20px; ;">
        </section>

        <section>
            <h2 class="no-caps">Unicode</h2>

            <ul>
                <li>Standard informatique du texte depuis 1991</li>
                <li>CoordonnÃ© par le Consortium Unicode (organisation privÃ©e sans but lucratif)</li>
                <li>Commence Ã  s'intÃ©resser aux Emoji en 2007</li>
            </ul>
        </section>

        <section>
            <h2 class="no-caps">La naissance des Emoji</h2>

            <ul>
                <li>855 emoji intÃ©grÃ©s Ã  Unicode 6.0 en 2010
                    <ul>
                        <li>Les pictogrammes Japonais</li>
                        <li>Quelques nouveaux</li>
                        <li>Certains icÃ´nes dÃ©jÃ  dans Unicode</li>
                    </ul>
                </li>
            </ul>

            <p>ğŸ¢ ğŸ¤ ğŸ¥ ğŸ¯ ğŸ‘˜ ğŸŒ ğŸ—» ğŸ</p>
            <p>ğŸ˜‘ ğŸ˜¬ ğŸ’© ğŸ¦„ ğŸ™ ğŸš™ ğŸŒ¦ ğŸ¸</p>
        </section>


        <section>
            <h2 class="no-caps">Adoption</h2>

            <ul>
                <li>AjoutÃ© dans l'iPhone en 2008, au Japon uniquement ğŸ‡¯ğŸ‡µ
                <li>Support complet en 2011
                <li>Tout le monde a suivi, d'Android Ã  Windows</li>
            </ul>
        </section>


        <section>
            <h2 class="no-caps">â–¡ Support aujourd'hui â–¡</h2>

            <ul>
                <li>Apple iOS et macOS</li>
                <li>Android</li>
                <li>Windows 10</li>
                <li>Linux ğŸ§ Ubuntu 18.04</li>
                <li><a href="http://caniemoji.com/">caniemoji.com</a></li>
                <li>ProblÃ¨mes : sans couleurs â›‡, tofu â–¡, invalide ï¿½...</li>
                <li class="fragment">Elasticsearch ?</li>
            </ul>
        </section>


        <section>
            <h2 class="no-caps">Les code points</h2>

            <ul>
                <li><em>U+1F355</em> est ğŸ•
                <li><em>U+1F308</em> est ğŸŒˆ
                <li><em>U+1F427</em> est ğŸ§
            </ul>
        </section>

        <section>
            <h2 class="no-caps">Les Emoji dans Unicode</h2>

            <p>Les emoji sont comme du texte. C'est votre systÃ¨me d'exploitation qui est capable de les afficher en image.</p>

            <p>
                <img src="images/display-devices.png" alt="emoji display accross devices">
            </p>

            <p><small><a href="https://unicode.org/emoji/charts/full-emoji-list.html">Full emoji list.</a></small></p>
        </section>

        <section>
            <img src="images/fail-samsung-cookies.png" alt="Emoji fail cookies">
        </section>

        <section>
            <img src="images/fail-google-burger.png" alt="Emoji fail burger order" style="width: 60%">
        </section>

        <section>
            <img src="images/fail-samsung-hand.jpeg" alt="Emoji fail hands">
        </section>

        <section>
            <h3>Peu importe ce qui est affichÃ©, c'est le code point qui porte le sens.</h3>
        </section>

       <!-- <section>
            <h2 class="no-caps">Les emoji et le texte</h2>

            <p>La spÃ©cification comporte maintenant :</p>

            <ul>
                <li>Des mÃ©tiers ğŸ‘® ;</li>
                <li>Des Ã©motions ğŸ˜ ;
                <li>De la nourriture ğŸ• ;
                <li>Des animaux ğŸ˜ ;
                <li>Des sports ğŸš´ ;
                <li>Des objets ğŸ’ ğŸ“‹ ğŸ”¦â€¦
            </ul>

        </section>-->

        <section>
            <h2 class="no-caps">L'utilisation des emoji</h2>

            <h5>Vous n'y Ã©chapperez pas !</h5>
            <ul>
                <li>Word of the Year du Oxford English Dictionary 2015 : ğŸ˜‚
                <li>World Emoji Day le 17 Juillet ğŸ‰
                <li>SupportÃ© partout ! Saisie super simple et claviers dÃ©diÃ©s sur mobile âŒ¨</li>
                <li>Emojipedia.org fait 45 millions de pages vues par mois</li>
            </ul>
        </section>

        <section>
            <h2>Oui, vos utilisateurs vont saisir ğŸ• dans votre moteur de recherche !</h2>
        </section>

        <section>
            <img src="images/github2.png" alt="Github">
        </section>
        <section>
            <img src="images/twitter2.png" alt="Twitter">
        </section>
        <section>
            <img src="images/yelp2.png" alt="Yelp">
        </section>

        <section>
            <h2 class="no-caps">Comment chercher comme Yelp</h2>
        </section>

        <section>
            <pre><code class="hljs json" data-trim>
PUT meal/_doc/1
{
  "title": "pizza"
}

GET meal/_search
{
  "query": {
    "match": {
      "title": "ğŸ•"
    }
  }
}</code></pre>

            <p class="fragment">Aucun rÃ©sultat</p>
        </section>

        <section>
            <h2 class="no-caps">C'est standard</h2>

            <ul>
                <li>Unicode spÃ©cifie <a href="http://unicode.org/reports/tr51/#Searching">comment faire de la recherche</a> (TR51)
                <li>Chaque emoji doit Ãªtre indexÃ© avec ses annotations, et cela dans toutes les langues cibles
            </ul>
        </section>

        <section>
            <h2 class="no-caps">Annotations CLDR de ğŸ•</h2>

            <ul>
                <li>En Anglais : cheese, pizza, slice</li>
                <li>En FranÃ§ais : fromage, part, pizza</li>
            </ul>

            <br>
            <br>
            <br>
            <h4 class="no-caps">Nous devons indexer "pizza" <br>quand il y a un emoji ğŸ•</h4>
            <h4 class="no-caps fragment">C'est le boulot des synonymes !</h4>
        </section>

        <section>
            <img style="width: 100%" src="images/ElasticsearchHorizontalTextWhite.svg" alt="Elasticsearch">
        </section>

        <section>
            <h2 class="no-caps">Dans Elasticsearch</h2>

            <ul>
                <li>Depuis 6.7 : Lucene 7.7.0 comprends les Emoji ğŸ¥°</li>
                <li>Entre 6.4 et 6.7 : Plugin officiel analysis-icu</li>
                <li>Avant 6.4 : ğŸ˜µ <a href="https://github.com/jolicode/emoji-search/tree/master/esplugin">Plugin maison</a> ğŸ”¥
                et plein de hack </li>
            </ul>
        </section>

        <section>
            <h2 class="no-caps">Lucene 7.7 â¤ï¸</h2>

            <p>Extrait des tests de Lucene :</p>
            <pre><code class="hljs java" data-trim>
/** simple emoji */
public void testEmoji() throws Exception {
    BaseTokenStreamTestCase.assertAnalyzesTo(
        a,
        "ğŸ’© ğŸ’©ğŸ’©",
        new String[] {"ğŸ’©", "ğŸ’©", "ğŸ’©"},
        new String[] {"&lt;EMOJI&gt;", "&lt;EMOJI&gt;", "&lt;EMOJI&gt;"}
    );
}</code></pre>

            <small>
                <a href="https://github.com/apache/lucene-solr/commit/283b19a8da6ab9e0b7e9a75b132d3067218d5502#diff-f8560c7a9c79fa371685c42a5bb486ebd0dbb56479e9af5849911dd95f4432db">
                    Le commit qui a tout changÃ© : "support Unicode UTS#51 v11.0 Emoji tokenization."
                </a>
            </small>
        </section>

        <section>
            <h2 class="no-caps">Emoji simple</h2>

            <pre><code class="hljs json" data-trim>
GET _analyze
{
  "text": ["ğŸ•"],
  "analyzer": "standard"
}</code></pre>

            <p class="fragment">Token <em>ğŸ•</em></p>
        </section>

        <section>
            <h2 class="no-caps">Ajout des synonymes</h2>

            <pre><code class="hljs json" data-trim>
GET _analyze
{
  "text": ["ğŸ•"],
  "tokenizer": "standard",
  "filter": [
    {
      "type": "synonym",
      "synonyms": [
        "ğŸ• => ğŸ•, cheese, pizza, slice"
      ]
    }
  ]
}</code></pre>

            <p class="fragment">Tokens <em>ğŸ•</em> <em>cheese</em> <em>pizza</em> <em>slice</em></p>
        </section>

        <section>
            <h2 class="no-caps">Recherche fonctionnelle</h2>

            <p class="">Tokens <em>ğŸ•</em> <em>cheese</em> <em>pizza</em> <em>slice</em> dans l'index</p>

            <ul>
                <li>Recherche avec "ğŸ•" : match âœ…</li>
                <li>Recherche avec "pizza" : match âœ…</li>
            </ul>
        </section>

        <section>
            <h2 class="no-caps">Liste de synonymes</h2>

            <ul>
                <li>Le CLDR fourni les annotations dans toutes les langues</li>
                <li>Unicode Common Locale Data Repository</li>
                <li>Je fournis juste les fichiers de synonymes dÃ©jÃ  prÃªts :</li>
            </ul>

            <p><a href="https://github.com/jolicode/emoji-search/">https://github.com/jolicode/emoji-search/</a></p>
        </section>

        <section>
            <pre>
    ğŸ» => ğŸ», bear, bear face, face
    ğŸ¨ => ğŸ¨, bear, koala
    ğŸ¼ => ğŸ¼, face, panda, panda face
    ğŸ¾ => ğŸ¾, feet, paw, paw prints, print
    ğŸ¦ƒ => ğŸ¦ƒ, bird, turkey
    ğŸ¥µ => ğŸ¥µ, feverish, heat stroke, hot, hot face, red-faced, sweating
    ğŸ¥¶ => ğŸ¥¶, blue-faced, cold, cold face, freezing, frostbite, icicles
    ğŸ£ => ğŸ£, baby, bird, chick, hatching, hatching chick
    ğŸ¤ => ğŸ¤, baby, baby chick, bird, chick
    ğŸ¥ => ğŸ¥, baby, bird, chick, front-facing baby chick
    ğŸ¤ => ğŸ¤, cross, crossed fingers, finger, hand, luck
    ğŸ¤Ÿ => ğŸ¤Ÿ, hand, ILY, love-you gesture
    ğŸŒ¾ => ğŸŒ¾, ear, grain, rice, sheaf of rice
    ğŸ‘±â€â™€ => ğŸ‘±â€â™€, blond-haired woman, blonde, hair, woman, woman: blond hair
    ğŸ§“ => ğŸ§“, adult, gender-neutral, old, older person, unspecified gender
    ğŸ‘´ => ğŸ‘´, adult, man, old
    ğŸ§â€â™€ => ğŸ§â€â™€, magical, woman elf
    ğŸ§ => ğŸ§, djinn, genie
    ...
            </pre>
        </section>


        <section>
            <h2>C'est un peu plus complexe dans la vraie vie</h2>
        </section>

        <section data-background="images/fun_flags.jpeg">
        </section>

        <section>
            <h2 class="no-caps">Composition</h2>

            <img src="images/raibowflag.png" alt="rainbow flag" style="position: absolute; right: 0; margin-top: 100px">
            <ul>
                <li>
                    SÃ©quence <abbr title="Zero Width Joiner">ZWJ</abbr> pour afficher un drapeau arc en ciel :

                    <ol>
                        <li>ğŸ³ <em>U+1F3F3</em></li>
                        <li>ZWJ <em>U+200D</em></li>
                        <li>ğŸŒˆ <em>U+1F308</em></li>
                    </ol>
                </li>
            </ul>
        </section>

        <section>
            <h2 class="no-caps">ZWJ dans ES</h2>

            <pre><code class="hljs json" data-trim>
GET _analyze
{
  "text": ["ğŸ³â€ğŸŒˆ"],
  "tokenizer": "standard",
  "filter": [
    {
      "type": "synonym",
      "synonyms": [
        "ğŸ³â€ğŸŒˆ => ğŸ³â€ğŸŒˆ, pride, rainbow, rainbow flag"
      ]
    }
  ]
}</code></pre>

            <p class="fragment">Tokens <em>ğŸ³â€ğŸŒˆ</em> <em>pride</em> <em>rainbow</em> <em>flag</em><br>
            La jointure est bien connue d'Elasticsearch</p>
        </section>

        <section>
            <h2 class="no-caps">Drapeaux</h2>

            <ul>
                <li>
                    249 combinaisons basÃ©es sur ISO 3166-1 alpha-2
                    <ul>
                        <li>Regional indicator symbol :
                        <li>ğŸ‡¦ ğŸ‡§ ğŸ‡¨ ğŸ‡© ğŸ‡ª ğŸ‡« ğŸ‡¬ ğŸ‡­ ğŸ‡® ğŸ‡¯ ğŸ‡° ğŸ‡± ğŸ‡² ğŸ‡³ ğŸ‡´ ğŸ‡µ ğŸ‡¶ ğŸ‡· ğŸ‡¸ ğŸ‡¹ ğŸ‡º ğŸ‡» ğŸ‡¼ ğŸ‡½ ğŸ‡¾ ğŸ‡¿
                        <li>ğŸ‡¨ <em>U+1F1E8</em> et ğŸ‡¦ <em>U+1F1E6</em> = ğŸ‡¨ğŸ‡¦
                        <li>ğŸ‡¨ğŸ‡­ ğŸ‡¨ğŸ‡³ ğŸ‡©ğŸ‡ª ğŸ‡ªğŸ‡¸ ğŸ‡«ğŸ‡· ğŸ‡¬ğŸ‡§ ğŸ‡®ğŸ‡¹ ğŸ‡¯ğŸ‡µ ğŸ‡°ğŸ‡· ğŸ‡·ğŸ‡º ğŸ‡ºğŸ‡¸...
                    </ul>
                </li>
            </ul>
        </section>


        <section>
            <h2 class="no-caps">Drapeaux</h2>

            <ul>
                <li>
                    D'autres exemples :
                    <ul>
                        <li>ğŸ‡®ğŸ‡¨ IC Canary Islands
                        <li>ğŸ‡½ğŸ‡° XK Kosovo
                        <li>ğŸ‡ºğŸ‡³ UN United Nations
                        <li>ğŸ‡ªğŸ‡º EU European Union
                        <li>ğŸ‡¹ğŸ‡¼ TW Taiwan, cachÃ© en Chine</li>
                    </ul>
                </li>
            </ul>
        </section>

        <section>
            <h2 class="no-caps">Drapeaux dans ES</h2>

            <pre><code class="hljs json" data-trim>
GET _analyze
{
  "text": ["ğŸ‡ªğŸ‡º"],
  "tokenizer": "standard",
  "filter": [
    {
      "type": "synonym",
      "synonyms": [
        "ğŸ‡ªğŸ‡º => ğŸ‡ªğŸ‡º, flag: European Union"
      ]
    }
  ]
}</code></pre>

            <p class="fragment">Tokens <em>ğŸ‡ªğŸ‡º</em> <em>flag</em> <em>European</em> <em>Union</em><br>
                Combinaisons lues par Elasticsearch</p>
        </section>

        <section>
            <h2 class="no-caps">Drapeaux subdivisions</h2>

            <ul>
                <li>
                    ISO 3166-2 subdivisions administratives
                    <ul>
                        <li>ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿ GB-SCT Ã‰cosse
                        <li>ğŸ´ó §ó ¢ó ·ó ¬ó ³ó ¿ GB-WLS Wales
                        <li>+ de 3000 possibilitÃ©es
                        <li>Seulement 4 supportÃ©es actuellement
                        <li class="fragment">On l'aura notre emoji <a href="https://www.emoji.bzh/">BZH</a> !
                    </ul>
                </li>
            </ul>
        </section>

        <section>
            <h2 class="no-caps">ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿ GB-SCT explosÃ©</h2>
            <ul style="font-size: 80%">
                <li><em>U+1F3F4</em> ğŸ´
                <li><em>U+E0067</em> TAG g
                <li><em>U+E0062</em> TAG b
                <li><em>U+E0073</em> TAG s
                <li><em>U+E0063</em> TAG c
                <li><em>U+E0074</em> TAG t
                <li><em>U+E007F</em> CANCEL TAG
            </ul>
        </section>

        <section>
            <h2 class="no-caps">Subdivisions dans ES</h2>

            <pre><code class="hljs json" data-trim>
GET _analyze
{
  "text": ["ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿"],
  "tokenizer": "standard",
  "filter": [
    {
      "type": "synonym",
      "synonyms": [
        "ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿ => ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿, flag, Scotland",
        "ğŸ´ó ¦ó ²ó ¢ó ²ó ¥ó ¿ => ğŸ´ó ¦ó ²ó ¢ó ²ó ¥ó ¿, flag, Bretagne, BZH"
      ]
    }
  ]
}</code></pre>

            <p class="fragment">Tokens <em>ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿</em> <em>flag</em> <em>Scotland</em><br>
                TrÃ¨s bon support</p>
        </section>

        <section>
            <h2 class="no-caps">Les modificateurs</h2>

            <ul>
                <li>
                    Fitzpatrick
                    <ul>
                        <li>ğŸ¤˜ <em>U+1F918</em>
                        <li>ğŸ¤˜ğŸ½ <em>U+1F918</em> + <em>U+1F3FD</em>
                    </ul>
                </li>
            </ul>
        </section>

        <section>
            <h2 class="no-caps">Fitzpatrick dans ES</h2>

            <pre><code class="hljs json" data-trim>
GET _analyze
{
  "text": ["ğŸ¤˜ğŸ½"],
  "tokenizer": "standard",
  "filter": [
    {
      "type": "synonym",
      "synonyms": [
        "ğŸ¤˜ğŸ½ => ğŸ¤˜ğŸ½, horns, medium skin tone"
      ]
    }
  ]
}</code></pre>

            <p class="fragment">Tokens <em>ğŸ¤˜ğŸ½</em> <em>horns</em> <em>medium</em> <em>skin</em> <em>tone</em><br>
                SupportÃ© aussi mais synonyme Ã  affiner</p>
        </section>

        <section>
            <h2 class="no-caps">SÃ©lecteur de variation</h2>

            <ul>
                <li>
                    Variations, exemple avec HEAVY BLACK HEART

                    <ul>
                        <li><em>â¤ </em> U+2764 en texte</li>
                        <li><em>â¤ï¸</em> U+2764 + U+FE0F en Emoji</li>
                        <li><em>ğŸ³ U+FE0F ZWJ ğŸŒˆ</em> !== <em>ğŸ³ ZWJ ğŸŒˆ</em></li>
                    </ul>
                </li>


            </ul>
        </section>

        <section>
            <h2 class="no-caps">Variations ES</h2>

            <pre><code class="hljs json" data-trim>
GET _analyze
{
  "text": ["ğŸ³ï¸â€ğŸŒˆ" , "â¤ï¸"],
  "tokenizer": "standard",
  "filter": [
    {
      "type": "synonym",
      "synonyms": [
        "ğŸ³â€ğŸŒˆ => ğŸ³â€ğŸŒˆ, pride, rainbow, rainbow flag",
        "â¤ => â¤, heart, red heart"
      ]
    }
  ]
}</code></pre>

            <p class="fragment">Tokens <em>ğŸ³ï¸â€ğŸŒˆ</em> <em>â¤ï¸</em><br>
                Nos synonymes ne matchent pas !</p>
        </section>

        <section>
            <h2 class="no-caps">Variations ES</h2>

            <p>
                On supprime les variateurs AVANT le filter de synonyme
            </p>

            <pre><code class="hljs json" data-trim>
{
  "type": "pattern_replace",
  "pattern": "\\uFE0E|\\uFE0F",
  "replace": ""
}
</code></pre>

            <p class="">Tokens <em>ğŸ³ï¸â€ğŸŒˆ</em> <em>â¤ï¸</em> <em>pride</em> <em>rainbow</em> <em>heart</em>...</p>
        </section>

        <section>
            <h2 class="no-caps">Les nouveaux emoji</h2>

            <ul>
                <li>Nouvelle version majeure d'Unicode tous les ans</li>
                <li>Elasticsearch 7.10.2 = Lucene 8.7.0 = Unicode 11</li>
                <li>Unicode 13 actuellement (Mars 2020)</li>
            </ul>
        </section>

        <section>
            <h2 class="no-caps">Nouveaux emoji dans ES</h2>

            <pre><code class="hljs json" data-trim>
GET _analyze
{
  "text": ["ğŸ¤ŒğŸ½", "ğŸ¥·ğŸ¿"]
}
</code></pre>

            <p class="">Tokens <em>ğŸ¤Œ</em> <em>ğŸ½</em> <em>ğŸ¥·</em> <em>ğŸ¿</em> sÃ©parÃ©s !</p>

            <p>
                <img style="height: 150px" src="images/pinched.png" alt="Pinched">
                <img style="height: 150px" src="images/ninja.png" alt="Ninja">
            </p>

            <p><small>Mais globalement c'est trÃ¨s fonctionnel.</small></p>
        </section>

        <section>
            <h2 class="no-caps">RÃ©capitulons</h2>

            <ul>
                <li>Installer un fichier de synonymes</li>
                <li>Supprimer les sÃ©lecteurs de variation</li>
                <li>Utiliser un token filter synonym</li>
            </ul>
        </section>

        <section>
            <code style="text-align: left;">
$ wget https://github.com/jolicode/emoji-search/raw/master/synonyms/cldr-emoji-annotation-synonyms-en.txt<br><br>
$ mv cldr-emoji-annotation-synonyms-en.txt /etc/elasticsearch/analysis/
            </code>
        </section>

        <section>
            <pre><code class="hljs json" data-trim style="font-size: 90%">PUT /tweets
{
  "settings": {
    "analysis": {
      "filter": {
        "english_emoji": {
          "type": "synonym",
          "synonyms_path": "analysis/cldr-emoji-annotation-synonyms-en.txt"
        },
        "emoji_variation_selector_filter": {
          "type": "pattern_replace",
          "pattern": "\\uFE0E|\\uFE0F",
          "replace": ""
        }
      },
      "analyzer": {
        "english_with_emoji": {
          "tokenizer": "standard",
          "filter": [
            "lowercase",
            "emoji_variation_selector_filter",
            "english_emoji"
          ]
        }
      }
    }
  }
}
            </code></pre>
        </section>

        <section>
            <pre><code class="hljs json" data-trim>GET tweets/_analyze
{
  "analyzer": "english_with_emoji",
  "text": "ğŸ• ğŸ"
}</code></pre>

            <p>
                <em>ğŸ•</em>
                <em>cheese</em>
                <em>pizza</em>
                <em>slice</em>
                <em>ğŸ</em>
                <em>fruit</em>
                <em>pineapple</em>
            </p>

            <p class="fragment">
                <img src="images/pineapple%20pizza.jpg" alt="Pizza">
            </p>
        </section>

        <section>
            <h2 class="no-caps">Aller plus loin...</h2>
        </section>

        <section>
            <h2 class="no-caps">GÃ©rer les emoticons</h2>

            <blockquote>:-)&nbsp;&nbsp;&nbsp;&nbsp;:D&nbsp;&nbsp;&nbsp;&nbsp;:-(&nbsp;&nbsp;&nbsp;&nbsp;
                ^_^&nbsp;&nbsp;&nbsp;&nbsp;;-)&nbsp;&nbsp;&nbsp;&nbsp;<3
            </blockquote>

            <p class="fragment">On va simplement mapper les emoticons vers leurs emoji respectifs avant la tokenisation !</p>
        </section>



        <section>
            <h2 class="no-caps">Emoticon Mapping</h2>

            <h3><em>:p</em> ressemble Ã  ğŸ˜›</h3>

            <pre><code class="hljs text" data-trim>
:P => ğŸ˜›
8-) => ğŸ˜
:s => ğŸ˜’
:| => ğŸ˜
O:-D => ğŸ˜‡
&lt;/3 => ğŸ’”
:'-| => ğŸ˜¢
</code></pre>
        </section>

        <section>
            <h2 class="no-caps">Un nouveau char_filter</h2>

            <pre><code class="hljs java" data-trim>"char_filter": {
    "emoticons_char_filter": {
      "type": "mapping",
      "mappings_path": "analysis/emoticons.txt"
    }
},</code></pre>

            <p>Fichier de mapping disponible : <a
                    href="https://github.com/jolicode/emoji-search/blob/master/emoticons.txt">https://github.com/jolicode/emoji-search/blob/master/emoticons.txt</a></p>
        </section>

        <section>
            <h2 class="no-caps">Un nouveau char_filter</h2>

            <pre><code class="hljs java" data-trim>"analyzer": {
   "english_with_emoji": {
     "char_filter": ["emoticons_char_filter"],
     "tokenizer": "standard",
     "filter": [
       "lowercase",
       "emoji_variation_selector_filter",
       "english_emoji"
     ]
   }
 }</code></pre>
        </section>

        <section>
            <pre><code class="hljs json" data-trim>GET tweets/_analyze
{
  "analyzer": "english_with_emoji",
  "text": "Sarcasm ;-)"
}</code></pre>

            <p>
                <em>sarcasm</em>
                <em>ğŸ˜‰</em>
                <em>face</em>
                <em>wink</em>
                <em>winking face</em>
            </p>

            <p class="fragment">
                Des informations d'intention / Ã©motion en plus<br>
                =<br>
                Une meilleure expÃ©rience de recherche
            </p>
        </section>

        <section>
            <h2>Pour rÃ©sumer</h2>

            <ul>
                <li>Les emoji sont des lettres comme les autres ğŸ” </li>
                <li>Leur recherche se base sur des synonymes ğŸ‘¥</li>
                <li>Le CLDR produit ses annotations pour nous ğŸ“</li>
                <li>Un fichier de synonymes tout prÃªt disponible âœ…</li>
                <li>Il y a plein de combinaisons possibles â™¾ï¸</li>
                <li>Supportez les emoji partout (sauf les mots de passe) ğŸ”’</li>
            </ul>
        </section>


        <section>
            <p>
                Merci pour votre attention ğŸ¤˜
            </p>

            <p>
                @damienalexandre
                <br>
                <a href="https://github.com/jolicode/emoji-search/">https://github.com/jolicode/emoji-search/</a>
            </p>

            <p>
                <a href="http://jolicode.com">
                    <img src="./lib/font/logo-fond-noir.svg" alt="JoliCode"  style="height: 90px;"/>
                </a>
            </p>

            <h2 style="font-size: 40px;">DÃ©veloppement Web<br>expertise<br>open-source</h2>
        </section>

        <section data-markdown>
            <script type="text/template">
                ## Ressources

                - https://emojipedia.org/
                - https://issues.apache.org/jira/browse/LUCENE-8366
                - https://www.unicode.org/reports/tr51/tr51-18.html
                - https://meowni.ca/posts/emoji-emoji-emoji/
                - https://twitter.com/damienalexandre
            </script>
        </section>

    </div>
</div>

<footer class="joli">
    Â« Indexer des Emoji ğŸ• dans Elasticsearch pour trouver des pizzas Â» &dash; ElasticCC 2021 &dash; <img
        src="lib/font/logo-fond-noir.svg" style="height:1em; vertical-align: text-bottom;"/>
</footer>


<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>

    // More info https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        transition: 'none', // none/fade/slide/convex/concave/zoom

        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
            {
                src: 'lib/js/classList.js', condition: function () {
                return !document.body.classList;
            }
            },
            {
                src: 'plugin/markdown/marked.js', condition: function () {
                return !!document.querySelector('[data-markdown]');
            }
            },
            {
                src: 'plugin/markdown/markdown.js', condition: function () {
                return !!document.querySelector('[data-markdown]');
            }
            },
            {
                src: 'plugin/highlight/highlight.js', async: true, callback: function () {
                hljs.initHighlightingOnLoad();
            }
            },
            {src: 'plugin/zoom-js/zoom.js', async: true},
            {src: 'plugin/notes/notes.js', async: true}
        ]
    });
</script>

</body>
</html>
